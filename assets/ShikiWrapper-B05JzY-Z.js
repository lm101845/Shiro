import{r as t,j as s}from"./index-C7_VpNE9.js";import{c as y,a as b}from"./helper-CaAdfMs7.js";import{u as C,g as R}from"./viewport-CYqKUIqi.js";import"./request-DNFlcv4i.js";import{s as L}from"./spring-BiPrtYZ-.js";import{m as E}from"./motion-minimal-ChEqHroa.js";import{u as $}from"./use-event-callback-CfAhoCBv.js";import{s as z}from"./dom-XXNktKeO.js";import{t as I}from"./toast-D9gHHAgJ.js";import{M}from"./StyledButton-C1bJw3kO.js";const _=({children:r,className:c,duration:o=.6,spring:n=!1})=>{const a=t.useRef(null),[d,l]=t.useState("auto");return t.useEffect(()=>{if(a.current){const h=new ResizeObserver(m=>{const f=m[0].contentRect.height;l(f)});return h.observe(a.current),()=>{h.disconnect()}}},[]),s.jsx(E.div,{className:y("overflow-hidden",c),style:{height:d},initial:!1,animate:{height:d},transition:n?L:{duration:o},children:s.jsx("div",{ref:a,children:r})})},H=0,B=({ref:r,size:c="base",element:o,selector:n}={})=>{const a=t.useRef(null),[d,l]=t.useState(!1),[h,m]=t.useState(!1),[f,p]=t.useState(!1),g=C(e=>e.h),i=t.useCallback(()=>{let e=a.current||r?.current||o;if(e)return n&&(e=e.querySelector(n)),e},[r,n,o]),u=$(()=>{const e=i();if(!e)return;if(e.scrollHeight<=e.clientHeight+2){p(!1),l(!1),m(!1);return}p(!0);const j=e.scrollTop+e.clientHeight>=e.scrollHeight-H,v=e.scrollTop<=H;l(j),m(v)});t.useEffect(()=>{const e=i();if(e)return e.addEventListener("scroll",u),()=>{e.removeEventListener("scroll",u)}},[u,i,o]),t.useEffect(()=>{u()},[u,g,o]);const x={base:"",lg:"-lg"}[c];return[a,f?b(d&&"mask-t",h&&"mask-b",!d&&!h&&"mask-both")+x:""]},w={"code-card":"_code-card_13eh4_1","scroll-container":"_scroll-container_13eh4_77"},O=r=>{const c=r.match(/filename="([^"]+)"/);return c?c[1]:null},X=r=>["javascript","typescript","ts","js","css","tsx","jsx","json","sql","markdown","vue","rust","go","cpp","c","html","asm","bash","ps","ps1","text","plaintext","txt","plain"].includes(r.toLowerCase()),A=t.forwardRef((r,c)=>{const{lang:o,content:n,attrs:a}=r,d=t.useCallback(()=>{navigator.clipboard.writeText(n),I.success("已复制到剪贴板")},[n]),[l,h]=t.useState(null);t.useImperativeHandle(c,()=>l);const[m,f]=t.useState(!0),[p,g]=t.useState(!1);t.useEffect(()=>{const e=l;if(!e)return;const v=R().h/2;if(e.scrollHeight>=v){g(!0);const S=e.querySelector(".highlighted");if(S){const k=parseInt(getComputedStyle(S).height||"0",10),T=e.querySelector("pre > code"),N=Array.from(T.children).indexOf(S);e.scrollTop=k*N-30}}else g(!1)},[n,l]);const i=t.useMemo(()=>O(a||""),[a]),[,u]=B({element:l,size:"lg"}),x=!!i;return s.jsxs("div",{className:b(w["code-card"],"group"),onCopy:z,children:[!!i&&s.jsxs("div",{className:"z-10 flex w-full items-center justify-between rounded-t-xl bg-accent/20 px-5 py-2 text-sm",children:[s.jsx("span",{className:"shrink-0 grow truncate",children:i}),s.jsx("span",{className:"pointer-events-none shrink-0 grow-0","aria-hidden":!0,children:o?.toUpperCase()})]}),!i&&!!o&&s.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute bottom-3 right-3 z-10 text-sm opacity-60",children:o.toUpperCase()}),s.jsxs("div",{className:"bg-accent/5 py-4",children:[s.jsx(M,{onClick:d,className:b("absolute right-2 top-2 z-[1] flex text-xs center","rounded-md border border-accent/5 bg-accent/80 p-1.5 text-white backdrop-blur duration-200","opacity-0 group-hover:opacity-100",i&&"!top-12"),children:s.jsx("i",{className:"icon-[mingcute--copy-2-fill] size-4"})}),s.jsxs(_,{spring:!0,className:"relative",children:[s.jsx("div",{ref:h,className:y("relative max-h-[50vh] w-full overflow-auto",m?p?u:"":"!max-h-full",w["scroll-container"]),style:{"--sr-margin":x?"1rem":`${(o?.length||0)*14+4}px`},dangerouslySetInnerHTML:t.useMemo(()=>r.renderedHTML?{__html:r.renderedHTML}:void 0,[r.renderedHTML]),children:r.children}),p&&m&&s.jsx("div",{className:`absolute inset-x-0 bottom-0 flex justify-center py-2 duration-200 ${["mask-both-lg","mask-b-lg"].includes(u)?"":"pointer-events-none opacity-0"}`,children:s.jsxs("button",{onClick:()=>f(!1),"aria-hidden":!0,className:"flex items-center justify-center text-xs",children:[s.jsx("i",{className:"icon-[mingcute--arrow-to-down-line]"}),s.jsx("span",{className:"ml-2",children:"展开"})]})})]})]})]})});A.displayName="ShikiHighLighterWrapper";export{_ as A,A as S,X as i};
